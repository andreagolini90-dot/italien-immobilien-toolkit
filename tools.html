<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rechner &amp; Tools - Italien Immobilien</title>
  <meta name="description" content="Kostenrechner, Steuerrechner, Checkliste und Problemloeser fuer den Immobilienkauf in Italien. Alle Tools auf einer Seite.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Cinzel:wght@400;500;600;700;900&display=swap" rel="stylesheet">
  <style>
    /* ============================================================
       SHARED CSS (from shared.css) - inlined
       ============================================================ */
    :root {
      --primary: #3A4359;
      --primary-light: #4d5570;
      --accent: #ffffff;
      --accent-hover: #e0e0e0;
      --white: #ffffff;
      --bg: #3A4359;
      --bg-light: #454d66;
      --gray-50: #F9FAFB;
      --gray-100: #f3f4f6;
      --gray-200: rgba(255,255,255,0.15);
      --gray-300: rgba(255,255,255,0.25);
      --gray-500: rgba(255,255,255,0.7);
      --gray-700: rgba(255,255,255,0.85);
      --gray-900: #1F1F1F;
      --text: #ffffff;
      --text-muted: rgba(255,255,255,0.7);
      --green: #16a34a;
      --radius: 8px;
      --shadow: 0 1px 3px rgba(0,0,0,0.2), 0 1px 2px rgba(0,0,0,0.12);
      --shadow-lg: 0 10px 15px rgba(0,0,0,0.2), 0 4px 6px rgba(0,0,0,0.1);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Cinzel', serif;
      font-size: 20px;
      color: var(--text);
      background: transparent;
      line-height: 1.7;
      margin: 0;
      padding: 0;
      -webkit-font-smoothing: antialiased;
    }

    h1, h2, h3 {
      font-family: 'Playfair Display', serif;
      font-weight: 900;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 16px 32px 40px;
      background: var(--bg);
      border-radius: 12px;
    }

    /* ============================================================
       TAB NAVIGATION
       ============================================================ */
    .tab-nav {
      display: flex;
      flex-wrap: wrap;
      gap: 0;
      margin: 0;
      border-bottom: 2px solid rgba(255,255,255,0.2);
    }
    .tab-btn {
      flex: 1 1 auto;
      min-width: 0;
      padding: 18px 16px;
      background: transparent;
      border: none;
      border-bottom: 3px solid transparent;
      color: var(--text-muted);
      font-family: 'Cinzel', serif;
      font-size: 1.1rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
      margin-bottom: -2px;
    }
    .tab-btn:hover {
      color: var(--text);
      background: rgba(255,255,255,0.05);
    }
    .tab-btn.active {
      color: var(--text);
      border-bottom-color: var(--white);
      background: rgba(255,255,255,0.08);
    }

    /* Tab content panels */
    .tab-panel {
      display: none;
      padding-top: 36px;
      animation: fadeIn 0.3s ease;
    }
    .tab-panel.active {
      display: block;
    }

    /* Form Elements */
    .form-group {
      margin-bottom: 24px;
    }
    .form-group label {
      display: block;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 10px;
      font-size: 1.15rem;
    }
    .form-group .help-text {
      display: block;
      font-size: 1rem;
      color: var(--text-muted);
      margin-bottom: 10px;
      line-height: 1.5;
    }
    .form-group input[type="number"],
    .form-group input[type="text"],
    .form-group input[type="email"],
    .form-group select {
      width: 100%;
      padding: 16px 18px;
      border: 1px solid rgba(255,255,255,0.3);
      border-radius: var(--radius);
      font-size: 1.15rem;
      font-family: 'Cinzel', serif;
      background: rgba(255,255,255,0.1);
      color: var(--text);
      transition: border-color 0.2s;
    }
    .form-group input::placeholder {
      color: rgba(255,255,255,0.4);
    }
    .form-group select option {
      background: var(--primary);
      color: var(--text);
    }
    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(255,255,255,0.2);
    }

    /* Radio Group */
    .radio-group {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }
    .radio-group label {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 500;
      cursor: pointer;
      padding: 14px 22px;
      border: 1px solid rgba(255,255,255,0.3);
      border-radius: var(--radius);
      transition: all 0.2s;
      color: var(--text);
      font-size: 1.1rem;
    }
    .radio-group label:hover {
      border-color: var(--accent);
    }
    .radio-group input[type="radio"] {
      accent-color: var(--accent);
    }
    .radio-group input[type="radio"]:checked + span {
      color: var(--text);
      font-weight: 700;
    }

    /* Buttons */
    .btn {
      display: inline-block;
      padding: 18px 36px;
      border: none;
      border-radius: var(--radius);
      font-size: 1.2rem;
      font-weight: 700;
      font-family: 'Cinzel', serif;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
      text-decoration: none;
    }
    .btn-primary {
      background: var(--white);
      color: var(--primary);
    }
    .btn-primary:hover {
      background: var(--accent-hover);
      color: var(--primary);
    }
    .btn-secondary {
      background: var(--white);
      color: var(--primary);
    }
    .btn-secondary:hover {
      background: var(--gray-50);
    }
    .btn-outline {
      background: transparent;
      color: var(--white);
      border: 2px solid var(--white);
    }
    .btn-outline:hover {
      background: var(--white);
      color: var(--primary);
    }
    .btn-block {
      display: block;
      width: 100%;
    }

    /* Results Table */
    .results {
      margin-top: 32px;
      animation: fadeIn 0.3s ease;
    }
    .results h2 {
      font-size: 1.6rem;
      color: var(--text);
      margin-bottom: 24px;
    }
    .results-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 24px;
    }
    .results-table th,
    .results-table td {
      padding: 16px 20px;
      text-align: left;
      border-bottom: 1px solid rgba(255,255,255,0.15);
      font-size: 1.1rem;
      color: var(--text);
    }
    .results-table th {
      background: rgba(255,255,255,0.08);
      color: var(--text);
      font-weight: 700;
    }
    .results-table tr:last-child td {
      border-bottom: none;
    }
    .results-table .total-row {
      background: rgba(255,255,255,0.15);
      color: var(--white);
      font-weight: 700;
    }
    .results-table .total-row td {
      border-bottom: none;
      padding: 16px 18px;
      font-size: 1.15rem;
    }

    /* Cards */
    .card {
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.15);
      border-radius: var(--radius);
      padding: 24px;
      margin-bottom: 16px;
      box-shadow: var(--shadow);
      transition: all 0.2s;
    }
    .card:hover {
      box-shadow: var(--shadow-lg);
      background: rgba(255,255,255,0.12);
    }
    .card-clickable {
      cursor: pointer;
    }
    .card-clickable:hover {
      border-color: var(--accent);
    }
    .card h3 {
      color: var(--text) !important;
    }
    .card p {
      color: var(--text-muted) !important;
    }


    /* Accordion */
    .accordion-item {
      border: 1px solid rgba(255,255,255,0.15);
      border-radius: var(--radius);
      margin-bottom: 8px;
      overflow: hidden;
    }
    .accordion-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 24px;
      background: rgba(255,255,255,0.05);
      cursor: pointer;
      font-weight: 700;
      font-size: 1.15rem;
      color: var(--text);
      transition: background 0.2s;
    }
    .accordion-header:hover {
      background: rgba(255,255,255,0.1);
    }
    .accordion-header .step-number {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: var(--accent);
      color: var(--primary);
      font-size: 0.95rem;
      font-weight: 700;
      margin-right: 14px;
      flex-shrink: 0;
    }
    .accordion-header .arrow {
      transition: transform 0.2s;
      font-size: 0.8rem;
      color: var(--text-muted);
    }
    .accordion-item.open .accordion-header .arrow {
      transform: rotate(180deg);
    }
    .accordion-body {
      display: none;
      padding: 20px 24px;
      background: rgba(255,255,255,0.03);
    }
    .accordion-body p {
      color: var(--text-muted) !important;
    }
    .accordion-item.open .accordion-body {
      display: block;
    }

    /* Checklist Items */
    .checklist-item {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      padding: 8px 0;
    }
    .checklist-item::before {
      content: "•";
      color: var(--accent);
      font-size: 1.2rem;
      line-height: 1.5;
      flex-shrink: 0;
    }
    .checklist-item span {
      font-size: 1.1rem;
      color: var(--text-muted);
    }

    /* Error */
    .error-msg {
      color: #ff6b6b;
      font-size: 0.85rem;
      margin-top: 4px;
    }

    /* Exempt note (steuerrechner) */
    #sr_exemptNote {
      background: rgba(22,163,74,0.15) !important;
      color: var(--green) !important;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 24px;
    }
    #sr_exemptNote strong {
      color: var(--green);
    }

    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Responsive */
    @media (max-width: 600px) {
      body { font-size: 18px; }
      .container { padding: 12px 16px 28px; border-radius: 0; }
      .tab-nav { flex-wrap: wrap; }
      .tab-btn { flex: 1 1 45%; font-size: 1rem; padding: 14px 8px; }
      .form-group label { font-size: 1.1rem; }
      .form-group input[type="number"],
      .form-group input[type="text"],
      .form-group input[type="email"],
      .form-group select { font-size: 1.1rem; padding: 14px 16px; }
      .radio-group { flex-direction: column; }
      .radio-group label { font-size: 1.05rem; padding: 14px 18px; }
      .btn { font-size: 1.1rem; padding: 16px 28px; }
      .results-table { table-layout: fixed; }
      .results-table th, .results-table td { padding: 10px 8px; font-size: 0.85rem; word-break: break-word; overflow-wrap: break-word; }
      .accordion-header { font-size: 1.05rem; padding: 16px 18px; }
    }
  </style>
</head>
<body>
  <div class="container">

    <!-- ============================================================
         TAB NAVIGATION
         ============================================================ -->
    <div class="tab-nav">
      <button class="tab-btn active" onclick="switchTab('kostenrechner')" id="tabBtn_kostenrechner">Kosten</button>
      <button class="tab-btn" onclick="switchTab('steuerrechner')" id="tabBtn_steuerrechner">Steuern</button>
      <button class="tab-btn" onclick="switchTab('checkliste')" id="tabBtn_checkliste">Checkliste</button>
      <button class="tab-btn" onclick="switchTab('problemloeser')" id="tabBtn_problemloeser">Probleme</button>
    </div>

    <!-- ============================================================
         TAB 1: KOSTENRECHNER
         ============================================================ -->
    <div id="panel_kostenrechner" class="tab-panel active">

      <form id="kr_calcForm" onsubmit="return false;">
        <div class="form-group">
          <label for="kr_kaufpreis">Kaufpreis (EUR)</label>
          <input type="number" id="kr_kaufpreis" placeholder="z.B. 250000" min="1" required>
        </div>

        <div class="form-group">
          <label for="kr_immobilientyp">Immobilientyp</label>
          <select id="kr_immobilientyp" required>
            <option value="">-- Bitte waehlen --</option>
            <option value="erstwohnsitz">Erstwohnsitz (Prima Casa)</option>
            <option value="zweitwohnsitz">Zweitwohnsitz (Seconda Casa)</option>
            <option value="gewerbe">Gewerbeimmobilie</option>
          </select>
        </div>

        <div class="form-group">
          <label for="kr_region">Region</label>
          <select id="kr_region" required>
            <option value="">-- Bitte waehlen --</option>
            <option value="abruzzen">Abruzzen</option>
            <option value="aostatal">Aostatal</option>
            <option value="apulien">Apulien</option>
            <option value="basilikata">Basilikata</option>
            <option value="emilia-romagna">Emilia-Romagna</option>
            <option value="friaul">Friaul-Julisch Venetien</option>
            <option value="kalabrien">Kalabrien</option>
            <option value="kampanien">Kampanien</option>
            <option value="latium">Latium</option>
            <option value="ligurien">Ligurien</option>
            <option value="lombardei">Lombardei</option>
            <option value="marken">Marken</option>
            <option value="molise">Molise</option>
            <option value="piemont">Piemont</option>
            <option value="sardinien">Sardinien</option>
            <option value="sizilien">Sizilien</option>
            <option value="suedtirol">Suedtirol-Trentino</option>
            <option value="toskana">Toskana</option>
            <option value="umbrien">Umbrien</option>
            <option value="venetien">Venetien</option>
          </select>
        </div>

        <div class="form-group">
          <label>Kauferstatus</label>
          <div class="radio-group">
            <label>
              <input type="radio" name="kr_status" value="eu" required>
              <span>EU-Buerger</span>
            </label>
            <label>
              <input type="radio" name="kr_status" value="nicht-eu">
              <span>Nicht-EU-Buerger</span>
            </label>
          </div>
        </div>

        <button type="button" class="btn btn-primary btn-block" onclick="krCalculate()">Kosten berechnen</button>
        <div id="kr_formError" class="error-msg" style="text-align:center; margin-top:8px;"></div>
      </form>

      <div id="kr_results" class="results" style="display:none;">
        <h2>Ihre Kostenaufstellung</h2>
        <table class="results-table">
          <thead>
            <tr>
              <th>Kostenart</th>
              <th>Satz</th>
              <th>Betrag</th>
            </tr>
          </thead>
          <tbody id="kr_resultsBody"></tbody>
        </table>

        <p style="font-size:0.8rem; color:var(--text-muted); margin-bottom:20px; font-style:italic;">
          Hinweis: Die Registersteuer wird in Italien auf den Katasterwert (Valore Catastale) berechnet, der in der Regel deutlich unter dem Kaufpreis liegt. Diese Berechnung basiert auf dem Kaufpreis und stellt daher eine konservative Schaetzung (Maximalwert) dar. Fuer eine praezise Berechnung empfehlen wir eine individuelle Analyse.
        </p>

      </div>

    </div>

    <!-- ============================================================
         TAB 2: STEUERRECHNER
         ============================================================ -->
    <div id="panel_steuerrechner" class="tab-panel">

      <form id="sr_taxForm" onsubmit="return false;">
        <div class="form-group">
          <label for="sr_rendita">Katasterertrag / Rendita Catastale (EUR)</label>
          <span class="help-text">Den Katasterertrag finden Sie im Kaufvertrag oder in der Katasterbescheinigung (Visura Catastale). Falls unbekannt, schaetzen Sie ca. 500 EUR fuer eine Wohnung.</span>
          <input type="number" id="sr_rendita" placeholder="z.B. 500" min="1" required>
        </div>

        <div class="form-group">
          <label for="sr_immobilientyp">Immobilientyp</label>
          <select id="sr_immobilientyp" required>
            <option value="">-- Bitte waehlen --</option>
            <option value="wohnung">Wohnung</option>
            <option value="haus">Haus</option>
            <option value="gewerbe">Gewerbeimmobilie</option>
            <option value="grundstueck">Grundstueck</option>
          </select>
        </div>

        <div class="form-group">
          <label>Ist dies Ihr Erstwohnsitz in Italien?</label>
          <div class="radio-group">
            <label>
              <input type="radio" name="sr_erstwohnsitz" value="ja" required>
              <span>Ja</span>
            </label>
            <label>
              <input type="radio" name="sr_erstwohnsitz" value="nein">
              <span>Nein</span>
            </label>
          </div>
          <span class="help-text" style="margin-top:6px;">Erstwohnsitz (Residenza): Sie sind in der Gemeinde gemeldet und leben dort ueberwiegend.</span>
        </div>

        <button type="button" class="btn btn-primary btn-block" onclick="srCalculateTax()">Steuern berechnen</button>
        <div id="sr_formError" class="error-msg" style="text-align:center; margin-top:8px;"></div>
      </form>

      <div id="sr_results" class="results" style="display:none;">
        <h2>Ihre jaehrliche Steuerbelastung</h2>
        <table class="results-table">
          <thead>
            <tr>
              <th>Steuerart</th>
              <th>Details</th>
              <th>Betrag / Jahr</th>
            </tr>
          </thead>
          <tbody id="sr_resultsBody"></tbody>
        </table>

        <div id="sr_exemptNote" style="display:none;">
          <strong>Hinweis:</strong> Als Erstwohnsitz (Prima Casa) ist Ihre Immobilie von der IMU befreit.
        </div>

        <p style="font-size:0.8rem; color:var(--text-muted); margin-bottom:20px; font-style:italic;">
          Hinweis: Rentner mit Wohnsitz im Ausland, die eine in internationaler Konvention gereifte Rente beziehen, erhalten eine Ermaessigung von 50% auf die IMU fuer eine nicht vermietete Immobilie in Italien. Die TARI variiert je nach Gemeinde &mdash; die angegebenen Werte sind Richtwerte. Fuer eine praezise Berechnung empfehlen wir eine individuelle Analyse.
        </p>

      </div>

      <!-- Agevolazioni Fiscali Section -->
      <div style="margin-top:40px; padding-top:32px; border-top:2px solid rgba(255,255,255,0.3);">
        <h2 style="color:var(--text); margin-bottom:20px;">Steuervorteile fuer Zuwanderer nach Italien</h2>
        <p style="color:var(--text-muted); margin-bottom:24px;">Italien bietet attraktive Steuervorteile fuer Personen, die ihren Wohnsitz nach Italien verlegen. Pruefen Sie, ob Sie berechtigt sind:</p>

        <div class="card" style="margin-bottom:16px;">
          <h3 style="color:var(--accent) !important; margin-bottom:8px;">Flat Tax 7% fuer Rentner</h3>
          <p style="color:var(--text-muted) !important; margin-bottom:8px;">Pauschalsteuer von nur <strong style="color:var(--text);">7%</strong> auf alle auslaendischen Einkuenfte fuer <strong style="color:var(--text);">10 Jahre</strong>.</p>
          <ul style="color:var(--text-muted); padding-left:20px; font-size:0.9rem;">
            <li>Fuer Rentner mit auslaendischer Rente</li>
            <li>Wohnsitz in Sueditalien (Gemeinde unter 20.000 Einwohner)</li>
            <li>Regionen: Sizilien, Kalabrien, Sardinien, Kampanien, Basilikata, Abruzzen, Molise, Apulien</li>
            <li>Nicht in Italien steuerlich ansaessig in den letzten 5 Jahren</li>
            <li>Befreiung von IVIE und IVAFE Vermoegenssteuer</li>
          </ul>
        </div>

        <div class="card" style="margin-bottom:16px;">
          <h3 style="color:var(--accent) !important; margin-bottom:8px;">Regime Impatriati fuer Arbeitnehmer</h3>
          <p style="color:var(--text-muted) !important; margin-bottom:8px;">Steuerbefreiung von <strong style="color:var(--text);">50%</strong> des Einkommens (60% mit Kindern) fuer <strong style="color:var(--text);">5 Jahre</strong>.</p>
          <ul style="color:var(--text-muted); padding-left:20px; font-size:0.9rem;">
            <li>Fuer qualifizierte Arbeitnehmer und Selbstaendige</li>
            <li>Maximal 600.000 EUR beguenstigtes Einkommen pro Jahr</li>
            <li>Nicht in Italien steuerlich ansaessig in den letzten 3 Jahren</li>
            <li>Verpflichtung, mindestens 4 Jahre in Italien zu bleiben</li>
          </ul>
        </div>

        <div class="card" style="margin-bottom:16px;">
          <h3 style="color:var(--accent) !important; margin-bottom:8px;">Flat Tax fuer vermoeegende Neuzuziehende (ab 2026)</h3>
          <p style="color:var(--text-muted) !important; margin-bottom:8px;">Pauschalsteuer von <strong style="color:var(--text);">300.000 EUR/Jahr</strong> auf saemtliche auslaendische Einkuenfte.</p>
          <ul style="color:var(--text-muted); padding-left:20px; font-size:0.9rem;">
            <li>Fuer Personen mit hohem Vermoegen und Auslandseinkuenften</li>
            <li>Nicht in Italien steuerlich ansaessig in 9 der letzten 10 Jahre</li>
            <li>Zusaetzlich 50.000 EUR pro Familienmitglied</li>
            <li>Italienische Einkuenfte werden normal besteuert</li>
          </ul>
        </div>

      </div>

    </div>

    <!-- ============================================================
         TAB 3: CHECKLISTE
         ============================================================ -->
    <div id="panel_checkliste" class="tab-panel">

      <div id="cl_checklist">

        <!-- Step 1 -->
        <div class="accordion-item">
          <div class="accordion-header" onclick="clToggleAccordion(this)">
            <div><span class="step-number">1</span> Steuernummer (Codice Fiscale) beantragen</div>
            <span class="arrow">&#9660;</span>
          </div>
          <div class="accordion-body">
            <p style="margin-bottom:12px; color:var(--gray-700);">Die italienische Steuernummer ist Voraussetzung fuer jeden Immobilienkauf. Sie koennen sie beim italienischen Konsulat oder direkt bei der Agentur der Einnahmen (Agenzia delle Entrate) beantragen.</p>
            <div class="checklist-item"><span>Gueltigen Reisepass oder Personalausweis bereithalten</span></div>
            <div class="checklist-item"><span>Antrag beim italienischen Konsulat oder online stellen</span></div>
            <div class="checklist-item"><span>Codice Fiscale erhalten und sicher aufbewahren</span></div>
          </div>
        </div>

        <!-- Step 2 -->
        <div class="accordion-item">
          <div class="accordion-header" onclick="clToggleAccordion(this)">
            <div><span class="step-number">2</span> Italienisches Bankkonto eroeffnen</div>
            <span class="arrow">&#9660;</span>
          </div>
          <div class="accordion-body">
            <p style="margin-bottom:12px; color:var(--gray-700);">Ein italienisches Bankkonto erleichtert die Zahlungsabwicklung erheblich. Viele Banken bieten Konten fuer Nichtresidenten an.</p>
            <div class="checklist-item"><span>Bank mit Erfahrung fuer auslaendische Kunden waehlen</span></div>
            <div class="checklist-item"><span>Conto Corrente per Non Residenti eroeffnen</span></div>
            <div class="checklist-item"><span>IBAN fuer Ueberweisungen bereithalten</span></div>
          </div>
        </div>

        <!-- Step 3 -->
        <div class="accordion-item">
          <div class="accordion-header" onclick="clToggleAccordion(this)">
            <div><span class="step-number">3</span> Immobilie suchen und besichtigen</div>
            <span class="arrow">&#9660;</span>
          </div>
          <div class="accordion-body">
            <p style="margin-bottom:12px; color:var(--gray-700);">Nehmen Sie sich ausreichend Zeit fuer die Suche. Nutzen Sie lokale Agenturen und Online-Portale. Besichtigen Sie die Immobilie persoenlich.</p>
            <div class="checklist-item"><span>Immobilienagentur mit Ortskenntnis beauftragen</span></div>
            <div class="checklist-item"><span>Online-Portale durchsuchen (Immobiliare.it, Idealista)</span></div>
            <div class="checklist-item"><span>Persoenliche Besichtigung durchfuehren</span></div>
            <div class="checklist-item"><span>Umgebung und Infrastruktur pruefen</span></div>
          </div>
        </div>

        <!-- Step 4 -->
        <div class="accordion-item">
          <div class="accordion-header" onclick="clToggleAccordion(this)">
            <div><span class="step-number">4</span> Rechtliche Pruefung (Due Diligence)</div>
            <span class="arrow">&#9660;</span>
          </div>
          <div class="accordion-body">
            <p style="margin-bottom:12px; color:var(--gray-700);">Dies ist der wichtigste Schritt. Ein Anwalt prueft alle rechtlichen Aspekte der Immobilie, bevor Sie kaufen. Ueberspringen Sie diesen Schritt niemals.</p>
            <div class="checklist-item"><span>Katasterauszug (Visura Catastale) anfordern</span></div>
            <div class="checklist-item"><span>Baukonformitaet pruefen (Conformita Urbanistica)</span></div>
            <div class="checklist-item"><span>Grundbuchauszug auf Belastungen pruefen (Ipoteche)</span></div>
            <div class="checklist-item"><span>Energieausweis (APE) vorhanden?</span></div>
            <div class="checklist-item"><span>Eventuellen Bauverstoss (Abuso Edilizio) ausschliessen</span></div>
          </div>
        </div>

        <!-- Step 5 -->
        <div class="accordion-item">
          <div class="accordion-header" onclick="clToggleAccordion(this)">
            <div><span class="step-number">5</span> Vorvertrag (Compromesso) unterzeichnen</div>
            <span class="arrow">&#9660;</span>
          </div>
          <div class="accordion-body">
            <p style="margin-bottom:12px; color:var(--gray-700);">Der Vorvertrag (Contratto Preliminare) ist bindend. Er legt Preis, Bedingungen und Fristen fest. Ueblich ist eine Anzahlung von 10-30% des Kaufpreises.</p>
            <div class="checklist-item"><span>Vertragsbedingungen mit Anwalt pruefen</span></div>
            <div class="checklist-item"><span>Anzahlung (Caparra) vereinbaren und ueberweisen</span></div>
            <div class="checklist-item"><span>Frist fuer Notarvertrag (Rogito) festlegen</span></div>
            <div class="checklist-item"><span>Aufschiebende Bedingungen einbauen (falls noetig)</span></div>
          </div>
        </div>

        <!-- Step 6 -->
        <div class="accordion-item">
          <div class="accordion-header" onclick="clToggleAccordion(this)">
            <div><span class="step-number">6</span> Notarvertrag (Rogito) abschliessen</div>
            <span class="arrow">&#9660;</span>
          </div>
          <div class="accordion-body">
            <p style="margin-bottom:12px; color:var(--gray-700);">Der Rogito ist der endgueltige Kaufvertrag vor dem Notar. An diesem Tag wird die Immobilie offiziell uebertragen und die Restzahlung geleistet.</p>
            <div class="checklist-item"><span>Notar auswaehlen (Kaeufer hat das Wahlrecht)</span></div>
            <div class="checklist-item"><span>Vereidigten Dolmetscher organisieren (falls kein Italienisch)</span></div>
            <div class="checklist-item"><span>Restkaufpreis per Bankueberweisung bereitstellen</span></div>
            <div class="checklist-item"><span>Steuern und Notargebuehren zahlen</span></div>
            <div class="checklist-item"><span>Schluessel erhalten</span></div>
          </div>
        </div>

        <!-- Step 7 -->
        <div class="accordion-item">
          <div class="accordion-header" onclick="clToggleAccordion(this)">
            <div><span class="step-number">7</span> Eigentuemerwechsel (Voltura) eintragen</div>
            <span class="arrow">&#9660;</span>
          </div>
          <div class="accordion-body">
            <p style="margin-bottom:12px; color:var(--gray-700);">Nach dem Rogito muss der Eigentuemerwechsel beim Katasteramt und bei der Gemeinde eingetragen werden. Dies uebernimmt in der Regel der Notar.</p>
            <div class="checklist-item"><span>Voltura Catastale beim Katasteramt (durch Notar)</span></div>
            <div class="checklist-item"><span>Eintragung beim Grundbuchamt (Conservatoria)</span></div>
            <div class="checklist-item"><span>Gemeinde ueber Eigentuemerwechsel informieren</span></div>
          </div>
        </div>

        <!-- Step 8 -->
        <div class="accordion-item">
          <div class="accordion-header" onclick="clToggleAccordion(this)">
            <div><span class="step-number">8</span> Steuervorteile pruefen</div>
            <span class="arrow">&#9660;</span>
          </div>
          <div class="accordion-body">
            <p style="margin-bottom:12px; color:var(--gray-700);">Italien bietet erhebliche Steuervorteile fuer Personen, die ihren Wohnsitz verlegen. Pruefen Sie vor dem Kauf, ob Sie berechtigt sind &mdash; dies kann die Gesamtkosten drastisch senken.</p>
            <div class="checklist-item"><span><strong>Rentner:</strong> Flat Tax 7% auf alle Auslandseinkuenfte fuer 10 Jahre (Wohnsitz in Sueditalien, Gemeinde unter 20.000 Einwohner)</span></div>
            <div class="checklist-item"><span><strong>Arbeitnehmer:</strong> Regime Impatriati &mdash; 50-60% Steuerbefreiung fuer 5 Jahre (qualifizierte Fachkraefte)</span></div>
            <div class="checklist-item"><span><strong>Vermoeegende:</strong> Flat Tax 300.000 EUR/Jahr auf alle Auslandseinkuenfte (ab 2026)</span></div>
            <div class="checklist-item"><span>Prima-Casa-Verguestigung pruefen (2% statt 9% Registersteuer bei Erstwohnsitz)</span></div>
            <div class="checklist-item"><span>Steuerberater oder Anwalt zu Doppelbesteuerungsabkommen DE-AT-CH/Italien konsultieren</span></div>
          </div>
        </div>

        <!-- Step 9 -->
        <div class="accordion-item">
          <div class="accordion-header" onclick="clToggleAccordion(this)">
            <div><span class="step-number">9</span> Nach dem Kauf: Vertraege und Steuern</div>
            <span class="arrow">&#9660;</span>
          </div>
          <div class="accordion-body">
            <p style="margin-bottom:12px; color:var(--gray-700);">Richten Sie die Versorgungsvertraege auf Ihren Namen um und melden Sie sich fuer die Immobiliensteuern an.</p>
            <div class="checklist-item"><span>Strom und Gas auf eigenen Namen umstellen</span></div>
            <div class="checklist-item"><span>Wasserversorgung umstellen</span></div>
            <div class="checklist-item"><span>IMU-Erklaerung bei der Gemeinde einreichen</span></div>
            <div class="checklist-item"><span>TARI (Abfallgebuehr) anmelden</span></div>
            <div class="checklist-item"><span>Gebaeudeversicherung abschliessen</span></div>
          </div>
        </div>

      </div>


    </div>

    <!-- ============================================================
         TAB 4: PROBLEMLOESER (informational accordion)
         ============================================================ -->
    <div id="panel_problemloeser" class="tab-panel">

      <p style="margin-bottom:24px; color:var(--text-muted);">Haeufige Probleme mit Immobilien in Italien und was Sie wissen muessen:</p>

      <div class="accordion-item">
        <div class="accordion-header" onclick="clToggleAccordion(this)">
          <div><span class="step-number">1</span> Bauliche Probleme (Abuso Edilizio)</div>
          <span class="arrow">&#9660;</span>
        </div>
        <div class="accordion-body">
          <p style="margin-bottom:12px; color:var(--gray-700);">Nicht genehmigte Umbauten betreffen schaetzungsweise 20% aller Immobilien in Italien. Sie koennen zu Bussgeldern, Abrissverfuegungen und Problemen beim Weiterverkauf fuehren.</p>
          <div class="checklist-item"><span>Technisches Gutachten durch Geometra erstellen lassen</span></div>
          <div class="checklist-item"><span>Pruefung der nachtraeglichen Genehmigung (Sanatoria)</span></div>
          <div class="checklist-item"><span>Urbanistischen Status bei der Gemeinde pruefen</span></div>
        </div>
      </div>

      <div class="accordion-item">
        <div class="accordion-header" onclick="clToggleAccordion(this)">
          <div><span class="step-number">2</span> Erbschaft und Nachlass (Successione)</div>
          <span class="arrow">&#9660;</span>
        </div>
        <div class="accordion-body">
          <p style="margin-bottom:12px; color:var(--gray-700);">Das italienische Erbrecht kennt Pflichtanteile (Quota Legittima). Auslaendische Testamente koennen anerkannt werden, erfordern aber Uebersetzung und Beglaubigung.</p>
          <div class="checklist-item"><span>Dichiarazione di Successione einreichen (Frist: 12 Monate)</span></div>
          <div class="checklist-item"><span>Eigentuemerwechsel im Kataster eintragen</span></div>
          <div class="checklist-item"><span>Bei Erbengemeinschaft: einvernehmliche Loesung oder gerichtliche Teilung</span></div>
        </div>
      </div>

      <div class="accordion-item">
        <div class="accordion-header" onclick="clToggleAccordion(this)">
          <div><span class="step-number">3</span> Eigentuemergemeinschaft (Condominio)</div>
          <span class="arrow">&#9660;</span>
        </div>
        <div class="accordion-body">
          <p style="margin-bottom:12px; color:var(--gray-700);">Kaeufer koennen fuer unbezahlte Nebenkosten des Vorbesitzers mithaften. Beschluesse koennen innerhalb von 30 Tagen angefochten werden.</p>
          <div class="checklist-item"><span>Jahresabrechnung und Kostenverteilung pruefen</span></div>
          <div class="checklist-item"><span>Offene Schulden des Vorbesitzers vor dem Kauf klaeren</span></div>
          <div class="checklist-item"><span>Verwalter (Amministratore) kann durch Eigentuemerversammlung abgesetzt werden</span></div>
        </div>
      </div>

      <div class="accordion-item">
        <div class="accordion-header" onclick="clToggleAccordion(this)">
          <div><span class="step-number">4</span> Grundbuch- und Katasterprobleme</div>
          <span class="arrow">&#9660;</span>
        </div>
        <div class="accordion-body">
          <p style="margin-bottom:12px; color:var(--gray-700);">Abweichungen zwischen Katasterdaten und tatsaechlichem Zustand der Immobilie muessen vor dem Verkauf behoben werden. Fehlende Dokumente koennen rekonstruiert werden.</p>
          <div class="checklist-item"><span>Aktuelle Visura Catastale anfordern und pruefen</span></div>
          <div class="checklist-item"><span>Geometra mit der Berichtigung beauftragen</span></div>
          <div class="checklist-item"><span>Grenzstreitigkeiten durch vereidigten Sachverstaendigen klaeren</span></div>
        </div>
      </div>

      <div class="accordion-item">
        <div class="accordion-header" onclick="clToggleAccordion(this)">
          <div><span class="step-number">5</span> Steuerfragen und Rueckstaende</div>
          <span class="arrow">&#9660;</span>
        </div>
        <div class="accordion-body">
          <p style="margin-bottom:12px; color:var(--gray-700);">Unbezahlte Immobiliensteuern (IMU, TARI) koennen Pfandrechte auf die Immobilie verursachen. Eine freiwillige Nachzahlung (Ravvedimento Operoso) reduziert Strafen deutlich.</p>
          <div class="checklist-item"><span>Offene Steuerbetraege bei der Gemeinde pruefen</span></div>
          <div class="checklist-item"><span>Doppelbesteuerungsabkommen DE/AT/CH pruefen</span></div>
          <div class="checklist-item"><span>Steuervertreter (Commercialista) in Italien beauftragen</span></div>
        </div>
      </div>

      <div class="accordion-item">
        <div class="accordion-header" onclick="clToggleAccordion(this)">
          <div><span class="step-number">6</span> Miet- und Pachtprobleme</div>
          <span class="arrow">&#9660;</span>
        </div>
        <div class="accordion-body">
          <p style="margin-bottom:12px; color:var(--gray-700);">Das italienische Mietrecht ist stark mieterfreundlich. Bestehende Mietvertraege ueberleben den Eigentuemerwechsel. Raeumungen (Sfratto) sind formelle Gerichtsverfahren.</p>
          <div class="checklist-item"><span>Mietvertraege (4+4 oder 3+2 Jahre) beim Finanzamt registrieren</span></div>
          <div class="checklist-item"><span>Kuendigungsfristen und gesetzliche Regelungen beachten</span></div>
          <div class="checklist-item"><span>Eigenmaechtige Raeumung ist strafbar &mdash; immer Gerichtsweg nutzen</span></div>
        </div>
      </div>

    </div>

  </div><!-- /.container -->

  <!-- ============================================================
       ALL JAVASCRIPT - INLINED
       ============================================================ -->
  <script>
    // ============================================================
    // ACTIVE TAB TRACKING
    // ============================================================
    var activeTab = 'kostenrechner';

    // ============================================================
    // TAB SWITCHING
    // ============================================================
    function switchTab(tabName) {
      activeTab = tabName;

      // Deactivate all tab buttons
      var btns = document.querySelectorAll('.tab-btn');
      for (var i = 0; i < btns.length; i++) {
        btns[i].classList.remove('active');
      }
      // Activate clicked tab button
      document.getElementById('tabBtn_' + tabName).classList.add('active');

      // Hide all panels
      var panels = document.querySelectorAll('.tab-panel');
      for (var j = 0; j < panels.length; j++) {
        panels[j].classList.remove('active');
      }
      // Show selected panel
      document.getElementById('panel_' + tabName).classList.add('active');
    }

    // ============================================================
    // FORMAT CURRENCY
    // ============================================================
    function formatEUR(amount) {
      return new Intl.NumberFormat('de-DE', {
        style: 'currency',
        currency: 'EUR',
        minimumFractionDigits: 0,
        maximumFractionDigits: 0
      }).format(amount);
    }

    function formatPercent(value) {
      return new Intl.NumberFormat('de-DE', {
        style: 'percent',
        minimumFractionDigits: 1,
        maximumFractionDigits: 2
      }).format(value);
    }

    // ============================================================
    // KOSTENRECHNER
    // ============================================================
    function krCalculate() {
      var kaufpreis = parseFloat(document.getElementById('kr_kaufpreis').value);
      var typ = document.getElementById('kr_immobilientyp').value;
      var region = document.getElementById('kr_region').value;
      var statusEl = document.querySelector('input[name="kr_status"]:checked');
      var errorEl = document.getElementById('kr_formError');

      // Validation
      if (!kaufpreis || kaufpreis <= 0) { errorEl.textContent = 'Bitte geben Sie einen gueltigen Kaufpreis ein.'; return; }
      if (!typ) { errorEl.textContent = 'Bitte waehlen Sie den Immobilientyp.'; return; }
      if (!region) { errorEl.textContent = 'Bitte waehlen Sie eine Region.'; return; }
      if (!statusEl) { errorEl.textContent = 'Bitte waehlen Sie Ihren Kauferstatus.'; return; }
      errorEl.textContent = '';

      // Calculations
      var registersteuerRate, registersteuerLabel;
      if (typ === 'erstwohnsitz') {
        registersteuerRate = 0.02;
        registersteuerLabel = 'Registersteuer (2%)';
      } else if (typ === 'zweitwohnsitz') {
        registersteuerRate = 0.09;
        registersteuerLabel = 'Registersteuer (9%)';
      } else {
        registersteuerRate = 0.22;
        registersteuerLabel = 'MwSt./IVA (22%)';
      }
      var registersteuer = kaufpreis * registersteuerRate;
      // Minimum €1,000 for Imposta di Registro on private purchases (Art. 10 D.Lgs. 23/2011)
      if (typ !== 'gewerbe' && registersteuer < 1000) {
        registersteuer = 1000;
      }

      // Gewerbe/IVA-Kauf: €200 registro + €200 ipotecaria + €200 catastale = €600
      // Privatkauf: €50 ipotecaria + €50 catastale = €100 (registro is the % rate above)
      var imposteFisse = (typ === 'gewerbe') ? 600 : 100;
      var imposteFisseLabel = (typ === 'gewerbe')
        ? 'Register-, Hypotheken- und Katastersteuer (pauschal)'
        : 'Hypotheken- und Katastersteuer (pauschal)';

      var notarRate = kaufpreis <= 500000 ? 0.01 : 0.005;
      var notarkosten = Math.max(kaufpreis * notarRate, 2000);
      var notarLabel = kaufpreis <= 500000 ? 'Notarkosten (ca. 1%)' : 'Notarkosten (ca. 0,5%)';

      var maklerRate = 0.0366;
      var maklerkosten = kaufpreis * maklerRate;

      var uebersetzung = 1500;

      var anwaltRate = 0.015;
      var anwaltskosten = Math.max(kaufpreis * anwaltRate, 2000);
      var anwaltLabel = anwaltskosten === 2000 ? 'Anwaltskosten (Min. 2.000)' : 'Anwaltskosten (1,5%)';

      var gesamt = registersteuer + imposteFisse + notarkosten + maklerkosten + uebersetzung + anwaltskosten;
      var gesamtMitKauf = kaufpreis + gesamt;

      // Build table
      // Adjust label if minimum applied
      if (typ !== 'gewerbe' && kaufpreis * registersteuerRate < 1000) {
        registersteuerLabel += ' (Mindestbetrag)';
      }

      var rows = [
        [registersteuerLabel, formatPercent(registersteuerRate), formatEUR(registersteuer)],
        [imposteFisseLabel, 'Pauschal', formatEUR(imposteFisse)],
        [notarLabel, formatPercent(notarRate), formatEUR(notarkosten)],
        ['Maklergebuehren (3% + MwSt.)', '3,66%', formatEUR(maklerkosten)],
        ['Uebersetzung & Apostille', 'Pauschal', formatEUR(uebersetzung)],
        [anwaltLabel, formatPercent(anwaltRate), formatEUR(anwaltskosten)],
      ];

      var html = '';
      rows.forEach(function(row) {
        html += '<tr><td>' + row[0] + '</td><td>' + row[1] + '</td><td>' + row[2] + '</td></tr>';
      });
      html += '<tr class="total-row"><td>Nebenkosten gesamt</td><td></td><td>' + formatEUR(gesamt) + '</td></tr>';
      html += '<tr class="total-row"><td><strong>Gesamtkosten inkl. Kaufpreis</strong></td><td></td><td><strong>' + formatEUR(gesamtMitKauf) + '</strong></td></tr>';

      document.getElementById('kr_resultsBody').innerHTML = html;
      document.getElementById('kr_results').style.display = 'block';
      document.getElementById('kr_results').scrollIntoView({ behavior: 'smooth' });
      setTimeout(notifyParentHeight, 50);

    }

    // ============================================================
    // STEUERRECHNER
    // ============================================================
    var SR_MULTIPLIERS = {
      'wohnung': 160,
      'haus': 160,
      'gewerbe': 65,
      'grundstueck': 135
    };

    var SR_TARI_ESTIMATES = {
      'wohnung': 250,
      'haus': 350,
      'gewerbe': 400,
      'grundstueck': 100
    };

    var SR_TYPE_LABELS = {
      'wohnung': 'Wohnung',
      'haus': 'Haus',
      'gewerbe': 'Gewerbe',
      'grundstueck': 'Grundstueck'
    };

    function srCalculateTax() {
      var rendita = parseFloat(document.getElementById('sr_rendita').value);
      var typ = document.getElementById('sr_immobilientyp').value;
      var erstwohnsitzEl = document.querySelector('input[name="sr_erstwohnsitz"]:checked');
      var errorEl = document.getElementById('sr_formError');

      if (!rendita || rendita <= 0) { errorEl.textContent = 'Bitte geben Sie den Katasterertrag ein.'; return; }
      if (!typ) { errorEl.textContent = 'Bitte waehlen Sie den Immobilientyp.'; return; }
      if (!erstwohnsitzEl) { errorEl.textContent = 'Bitte geben Sie an, ob es Ihr Erstwohnsitz ist.'; return; }
      errorEl.textContent = '';

      var isErstwohnsitz = erstwohnsitzEl.value === 'ja';
      var multiplier = SR_MULTIPLIERS[typ];
      var aliquota = 0.0086; // 8.6 per mille - standard base rate 2025

      var imu = 0;
      var imuDetails = '';
      if (isErstwohnsitz) {
        imu = 0;
        imuDetails = 'Befreit (Erstwohnsitz)';
        document.getElementById('sr_exemptNote').style.display = 'block';
      } else {
        imu = rendita * 1.05 * multiplier * aliquota;
        imuDetails = 'Rendita ' + formatEUR(rendita) + ' x 1,05 x ' + multiplier + ' x 0,86%';
        document.getElementById('sr_exemptNote').style.display = 'none';
      }

      var tari = SR_TARI_ESTIMATES[typ];
      var gesamt = imu + tari;

      var html = '';
      html += '<tr><td>IMU (Gemeindesteuer)</td><td>' + imuDetails + '</td><td>' + formatEUR(imu) + '</td></tr>';
      html += '<tr><td>TARI (Abfallgebuehr)</td><td>Schaetzung fuer ' + SR_TYPE_LABELS[typ] + '</td><td>ca. ' + formatEUR(tari) + '</td></tr>';
      html += '<tr class="total-row"><td><strong>Jaehrliche Gesamtbelastung</strong></td><td></td><td><strong>' + formatEUR(gesamt) + '</strong></td></tr>';

      document.getElementById('sr_resultsBody').innerHTML = html;
      document.getElementById('sr_results').style.display = 'block';
      document.getElementById('sr_results').scrollIntoView({ behavior: 'smooth' });
      setTimeout(notifyParentHeight, 50);

    }

    // ============================================================
    // CHECKLISTE
    // ============================================================
    function clToggleAccordion(header) {
      var item = header.parentElement;
      item.classList.toggle('open');
      setTimeout(notifyParentHeight, 50);
    }


    // Auto-resize iframe to fit content (no empty blue space)
    function notifyParentHeight() {
      var h = document.querySelector('.container').scrollHeight + 24;
      window.parent.postMessage({ type: 'resize-iframe', height: h }, '*');
    }
    // Send height on load, tab switch, and resize
    window.addEventListener('load', function() { setTimeout(notifyParentHeight, 100); });
    window.addEventListener('resize', notifyParentHeight);
    var origSwitch = switchTab;
    switchTab = function(t) { origSwitch(t); setTimeout(notifyParentHeight, 50); };
  </script>
</body>
</html>
